create table category
(
    id          int auto_increment
        primary key,
    name        varchar(100)                        not null,
    code        varchar(50)                         not null,
    description text                                null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null
);

create table customer
(
    id          int auto_increment
        primary key,
    name        varchar(255)                        null,
    phone       varchar(11)                         null,
    address     varchar(255)                        null,
    create_date timestamp default CURRENT_TIMESTAMP null,
    update_date timestamp default CURRENT_TIMESTAMP null,
    active_flag int(1)    default 1                 null
);

create table invoice_temp
(
    id            int auto_increment
        primary key,
    active_flag   int default 1  null,
    code          varchar(100)   null,
    product_name  varchar(100)   null,
    qty           int            null,
    price         decimal(15, 2) null,
    update_date   timestamp      null,
    shelf_name    varchar(20)    null,
    supplier_name varchar(50)    null,
    user_name     varchar(100)   null
);

create table menu
(
    id          int auto_increment
        primary key,
    parent_id   int                                 not null,
    url         varchar(100)                        not null,
    name        varchar(100)                        not null,
    order_index int(1)    default 0                 not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null
);

create table product_info
(
    id          int auto_increment
        primary key,
    cate_id     int                                 not null,
    name        varchar(100)                        not null,
    description text                                null,
    img_url     varchar(200)                        null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    constraint cateid_fk_product_info
        foreign key (cate_id) references category (id)
            on update cascade
);

create table product_in_stock
(
    id          int auto_increment
        primary key,
    product_id  int                                 not null,
    qty         int(100)                            not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    price       decimal(15, 2)                      not null,
    constraint productid_fk_product_instock
        foreign key (product_id) references product_info (id)
            on update cascade
);

create table product_status_detail_temp
(
    id                  int auto_increment
        primary key,
    product_name        varchar(100)   null,
    product_status_name varchar(100)   null,
    qty                 int            null,
    price_one           decimal(15, 2) null,
    price_total         decimal(15, 2) null,
    active_flag         int default 1  null,
    shelf_name          varchar(100)   null
);

create table role
(
    id          int auto_increment
        primary key,
    role_name   varchar(50)                         not null,
    description varchar(200)                        not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null
);

create table auth
(
    id          int auto_increment
        primary key,
    role_id     int                                 not null,
    menu_id     int                                 not null,
    permission  int(1)    default 1                 not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    constraint menuid_fk
        foreign key (menu_id) references menu (id)
            on update cascade,
    constraint roleid_fk_auth
        foreign key (role_id) references role (id)
            on update cascade
);

create index menuid_fk_auth
    on auth (menu_id);

create table shelf
(
    id          int auto_increment
        primary key,
    name        varchar(10) default 'Z'               not null,
    description varchar(200)                          null,
    active_flag int(1)      default 1                 not null,
    create_date timestamp   default CURRENT_TIMESTAMP not null,
    update_date timestamp   default CURRENT_TIMESTAMP not null,
    total       int         default 500               null,
    qty         int                                   null,
    qty_rest    int                                   null
);

create table shelf_oop
(
    id          int auto_increment
        primary key,
    name        varchar(20)                         not null,
    description varchar(200)                        null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    total       int       default 500               null,
    qty         int                                 null,
    qty_rest    int                                 null
);

create table supplier
(
    id          int auto_increment
        primary key,
    name        varchar(100)                        not null,
    phone       varchar(11)                         not null,
    address     varchar(100)                        not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    active_flag int(1)    default 1                 null
);

create table users
(
    id          int auto_increment
        primary key,
    user_name   varchar(50)                         not null,
    password    varchar(100)                        not null,
    email       varchar(100)                        null,
    name        varchar(100)                        not null,
    active_flag int(2)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    status      int       default 0                 null
);

create table history
(
    id          int auto_increment
        primary key,
    action_name varchar(100)                        not null,
    type        int(1)                              not null,
    product_id  int                                 not null,
    qty         int                                 not null,
    price       decimal(15, 2)                      not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    user_id     int                                 null,
    constraint history___fk_user
        foreign key (user_id) references users (id)
            on update cascade on delete cascade,
    constraint productid_fk_history
        foreign key (product_id) references product_info (id)
            on update cascade
);

create table invoice
(
    id          int auto_increment
        primary key,
    code        varchar(50)                         not null,
    type        int(1)                              not null,
    product_id  int                                 not null,
    qty         int                                 not null,
    price       decimal(15, 2)                      not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    supplier_id int                                 null,
    user_id     int                                 null,
    shelf_id    int                                 null,
    constraint invoice___fk_shelf
        foreign key (shelf_id) references shelf_oop (id)
            on update cascade on delete cascade,
    constraint invoice___fk_user
        foreign key (user_id) references users (id)
            on update cascade on delete cascade,
    constraint productid_fk_invoice
        foreign key (product_id) references product_info (id)
            on update cascade,
    constraint supplierid_fk_invoice
        foreign key (supplier_id) references supplier (id)
            on update cascade
);

create table product_detail
(
    id          int auto_increment
        primary key,
    product_id  int                                   not null,
    invoice_id  int                                   null,
    price_in    decimal(15, 2)                        not null,
    active_flag int(1)                                null,
    create_date timestamp   default CURRENT_TIMESTAMP null,
    update_date timestamp   default CURRENT_TIMESTAMP null,
    price_out   decimal(15, 2)                        null,
    supplier_id int                                   null,
    code        varchar(50)                           not null,
    status      varchar(10) default 'Valid'           null,
    shelf_name  varchar(20)                           null,
    constraint code
        unique (code),
    constraint invoiceid_fk_productdetail
        foreign key (invoice_id) references invoice (id)
            on update cascade,
    constraint product_info_id_fk_productdetail
        foreign key (product_id) references product_info (id)
            on update cascade,
    constraint supplierid_fk_productdetail
        foreign key (supplier_id) references supplier (id)
            on update cascade
);

create table user_role
(
    id          int auto_increment
        primary key,
    user_id     int                                 not null,
    role_id     int                                 not null,
    active_flag int(1)    default 1                 not null,
    create_date timestamp default CURRENT_TIMESTAMP not null,
    update_date timestamp default CURRENT_TIMESTAMP not null,
    constraint roleid_fk
        foreign key (role_id) references role (id)
            on update cascade,
    constraint userid_fk
        foreign key (user_id) references users (id)
            on update cascade
);

create index roleid_fk_user_role
    on user_role (role_id);

create index userid_fk_user_role
    on user_role (user_id);

create table vat
(
    id          int auto_increment
        primary key,
    code        varchar(200)                            null,
    tax         varchar(50)   default '123456789'       null,
    supplier_id int                                     null,
    percent     decimal(2, 1) default 0.1               null,
    price       decimal(15, 2)                          null,
    total       decimal(15, 2)                          null,
    active_flag int           default 1                 null,
    create_date timestamp     default CURRENT_TIMESTAMP null,
    update_date timestamp     default CURRENT_TIMESTAMP null,
    user_id     int                                     null,
    constraint vat_code_uindex
        unique (code),
    constraint supplierid_fk_vat
        foreign key (supplier_id) references supplier (id)
            on delete cascade,
    constraint vat___fk_user
        foreign key (user_id) references users (id)
            on update cascade on delete cascade
);

create table product_status_list
(
    id          int auto_increment
        primary key,
    code        varchar(50)                         not null,
    type        int(1)                              null,
    active_flag int(1)    default 1                 null,
    create_date timestamp default CURRENT_TIMESTAMP null,
    update_date timestamp default CURRENT_TIMESTAMP null,
    user_id     int                                 null,
    price       decimal(15, 2)                      null,
    vat_id      int                                 null,
    constraint import_list_code_uindex
        unique (code),
    constraint usersid_fk_importliststaudlist
        foreign key (user_id) references users (id),
    constraint vatid_product_status_list___fk
        foreign key (vat_id) references vat (id)
            on update cascade on delete cascade
);

create table product_detail_pt
(
    id                     int auto_increment
        primary key,
    product_id             int                                   not null,
    product_status_list_id int                                   null,
    price_in               decimal(15, 2)                        not null,
    active_flag            int(1)                                null,
    create_date            timestamp   default CURRENT_TIMESTAMP null,
    update_date            timestamp   default CURRENT_TIMESTAMP null,
    price_out              decimal(15, 2)                        null,
    code                   varchar(50)                           not null,
    status                 varchar(10) default 'Valid'           null,
    supplier_id            int                                   null,
    shelf_name             varchar(50)                           null,
    constraint code
        unique (code),
    constraint product_info_id_fk_productdetail_pt
        foreign key (product_id) references product_info (id)
            on update cascade,
    constraint product_status_list_fk_productdetail_pt
        foreign key (product_status_list_id) references product_status_list (id)
            on update cascade,
    constraint supplier_product_detail_pt___fk
        foreign key (supplier_id) references supplier (id)
            on update cascade on delete cascade
);

create table product_status_detail
(
    id                     int auto_increment
        primary key,
    product_status_list_id int            not null,
    product_id             int            not null,
    qty                    int            not null,
    price_one              decimal(15, 2) null,
    price_total            decimal(15, 2) null,
    active_flag            int default 1  null,
    qty_rest               int            null,
    shelf_id               int            null,
    constraint importlistid_fk_productstatsdetail
        foreign key (product_status_list_id) references product_status_list (id)
            on delete cascade,
    constraint productinfoid_fk_importdetailstatusdetail
        foreign key (product_id) references product_info (id)
            on delete cascade,
    constraint shelfid_product_status_detail___fk
        foreign key (shelf_id) references shelf (id)
            on update cascade on delete cascade
);

create table vat_detail
(
    id          int auto_increment
        primary key,
    vat_id      int            not null,
    product_id  int            null,
    qty         int            null,
    price_one   decimal(15, 2) null,
    price_total decimal(15, 2) null,
    active_flag int default 1  null,
    constraint productinfoid_fk_vatdetail
        foreign key (product_id) references product_info (id)
            on delete cascade,
    constraint vatid_fk_vatdetail
        foreign key (vat_id) references vat (id)
            on delete cascade
);

create table vat_detail_temp
(
    id            int auto_increment
        primary key,
    product_name  varchar(100)   null,
    qty           int            null,
    price_one     decimal(15, 2) null,
    price_total   decimal(15, 2) null,
    vat_name      varchar(50)    null,
    active_flag   int default 1  null,
    supplier_name varchar(100)   null
);

